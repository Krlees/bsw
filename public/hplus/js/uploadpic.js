function UploadPic(){this.sw=0,this.sh=0,this.tw=0,this.th=0,this.scale=0,this.maxWidth=0,this.maxHeight=0,this.maxSize=0,this.quality=0,this.fileSize=0,this.fileDate=null,this.fileType="",this.fileName="",this.input=null,this.canvas=null,this.before=function(){},this.error=function(){},this.callback=function(){}}UploadPic.prototype.init=function(a){this.maxWidth=a.maxWidth,this.maxHeight=a.maxHeight,this.maxSize=a.maxSize||0,this.quality=a.quality||.8,this.input=a.input,this.before=a.before||function(){},this.error=a.error||function(){},this.callback=a.callback||function(){},this._addEvent()},UploadPic.prototype._addEvent=function(){function b(b){a.before(),a._handelSelectFile(b)}var a=this;this.input.addEventListener("change",b,!1)},UploadPic.prototype._handelSelectFile=function(a){var b=a.target.files[0];return this.maxSize>0&&b.size>this.maxSize?(Messenger().error({message:"选择文件大于"+this.maxSize/1024/1024+"M，请重新选择",showCloseButton:!0,hideAfter:3}),this.error(),void 0):(this.fileName=b.name,this.fileSize=b.size,this.fileType=b.type,this.fileDate=b.lastModifiedDate,this._readImage(b),void 0)},UploadPic.prototype._readImage=function(a){function c(a){b._createImage(a)}var b=this;this._getURI(a,c)},UploadPic.prototype._getURI=function(a,b){function d(){var a=/^data:base64,/,c=this.result+"";a.test(c)&&(c=c.replace(a,"data:image/jpeg;base64,")),b&&b(c)}var c=new FileReader;return c.onload=d,c.readAsDataURL(a),!1},UploadPic.prototype._createImage=function(a){function d(){c._drawImage(this)}var b=new Image,c=this;b.onload=d,b.src=a},UploadPic.prototype._drawImage=function(a){var c,d,e,f;this.sw=a.width,this.sh=a.height,this.tw=a.width,this.th=a.height,this.scale=(this.sw/this.sh).toFixed(2),this.maxWidth&&this.tw>this.maxWidth&&(this.tw=this.maxWidth,this.th=Math.round(this.tw/this.scale)),this.maxHeight&&this.th>this.maxHeight&&(this.th=this.maxHeight,this.tw=Math.round(this.th*this.scale)),this.canvas=document.createElement("canvas"),c=this.canvas.getContext("2d"),this.canvas.width=this.tw,this.canvas.height=this.th,c.drawImage(a,0,0,a.width,a.height,0,0,this.tw,this.th),d=this.canvas.toDataURL("image/jpeg",this.quality),navigator.userAgent.match(/iphone/i)&&(e=new MegaPixImage(a),e.render(this.canvas,{maxWidth:this.tw,maxHeight:this.th,quality:this.quality,orientation:1}),d=this.canvas.toDataURL("image/jpeg",this.quality)),navigator.userAgent.match(/Android/i)&&(f=new JPEGEncoder,d=f.encode(c.getImageData(0,0,this.tw,this.th),100*this.quality)),this.callback(d),c.clearRect(0,0,this.tw,this.th),this.canvas.width=0,this.canvas.height=0,this.canvas=null};